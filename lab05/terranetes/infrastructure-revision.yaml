# Infrastructure Revision for Terranetes
# A Revision is a reusable template that platform teams create
# and developers can instantiate via CloudResources
#
# This Revision uses the workshop's OpenTofu module to create:
# - Azure Resource Group
# - GitHub Repository (via Azure provider integration)

apiVersion: terraform.appvia.io/v1alpha1
kind: Revision
metadata:
  name: workshop-infrastructure
spec:
  # Plan information - required by Terranetes
  plan:
    name: "workshop-infrastructure"
    description: |
      Creates infrastructure setup for a workshop participant using the 
      workshop's OpenTofu module from the GitHub repository.
      
      This demonstrates how Terranetes can use existing Terraform/OpenTofu 
      modules from Git repositories as cloud provider templates.
    revision: "v1.0.0"
  
  # OpenTofu/Terraform configuration
  configuration:
    # Source module from workshop repository
    # Uses the Terranetes-compatible OpenTofu module
    module: "https://github.com/Zure/platform-engineering-workshop.git//lab05/opentofu?ref=main"
    
    # Provider reference - only Azure for cloud provider compatibility
    providerRef:
      name: azure
    
    # Enable automatic approval for this workshop
    enableAutoApproval: true
    enableDriftDetection: true
  
  # Variables that users must/can provide
  inputs:
    - key: resource_group_name
      description: "Name of the Azure Resource Group to create"
      required: true
      
    - key: github_repo_name
      description: "Name of the GitHub repository to create"
      required: true
